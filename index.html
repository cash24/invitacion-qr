
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Invitación</title>
<meta name="description" content="Invitación con QR por parámetros de URL (id, nombre, mesa, invitados)">
<style>
  :root{ --bg:#0b132b; --card:#1c2541; --txt:#ffffff; --acc:#5bc0be; }
  html,body{margin:0;padding:0;background:#0b132b;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;color:var(--txt)}
  .wrap{max-width:780px;margin:0 auto;padding:24px}
  .card{background:var(--card);border-radius:16px;padding:20px 20px 24px;box-shadow:0 10px 30px rgba(0,0,0,.2)}
  h1{font-size:clamp(20px,4.5vw,28px);margin:.2em 0 .4em;line-height:1.2}
  .meta{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:12px;margin:12px 0 18px}
  .item{background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.12);border-radius:12px;padding:12px}
  .label{font-size:12px;opacity:.85;letter-spacing:.3px;text-transform:uppercase}
  .value{font-weight:700;font-size:18px;margin-top:2px;word-break:break-word}
  .qr{display:flex;justify-content:center;align-items:center;padding:18px}
  .err{background:#3b0d0d;color:#ffe6e6;border:1px solid #ff7a7a;border-radius:10px;padding:12px;margin-top:12px}
  .ok{background:rgba(91,192,190,.12);border:1px solid rgba(91,192,190,.45);border-radius:10px;padding:10px;margin:10px 0 0}
  .small{font-size:12px;opacity:.9}
  @media (max-width:640px){ .meta{grid-template-columns:1fr 1fr} }
  @media (max-width:420px){ .meta{grid-template-columns:1fr} }
</style>
</head>
<body>
<div class="wrap">
  <div class="card" role="group" aria-label="Detalles de la invitación">
    <h1>¡Bienvenida/o a la fiesta!</h1>

    <div id="status" class="ok small" style="display:none"></div>

    <div class="meta">
      <div class="item">
        <div class="label">Nombre</div>
        <div id="nombre" class="value">—</div>
      </div>
      <div class="item">
        <div class="label">Mesa</div>
        <div id="mesa" class="value">—</div>
      </div>
      <div class="item">
        <div class="label">Invitados</div>
        <div id="invitados" class="value">—</div>
      </div>
    </div>

    <div class="meta" style="margin-top:0">
      <div class="item">
        <div class="label">ID</div>
        <div id="id" class="value">—</div>
      </div>
      <div class="item" style="grid-column: span 2;">
        <div class="label">Enlace de esta invitación (para compartir)</div>
        <div id="link" class="value small" style="line-height:1.35;word-break:break-all">—</div>
      </div>
    </div>

    <div class="qr">
      <div id="qrcode" aria-label="Código QR de esta invitación"></div>
    </div>

    <p class="small" style="opacity:.9">Muestra este QR en la entrada. Si lo abres desde el link, el código se actualiza solo.</p>

    <div id="error" class="err" style="display:none"></div>
  </div>
</div>

<!-- Librería QR (carga desde CDN) -->
<script src="https://cdn.jsdelivr.net/gh/davidshimjs/qrcodejs/qrcode.min.jscript>
(function(){
  function parseParams(search) {
    const p = new URLSearchParams(search || '');
    const clean = v => (v || '').replace(/^"(.*)"$/,'$1').trim(); // quita comillas "..."
    return {
      id: clean(p.get('id')),
      nombre: clean(p.get('nombre')),
      mesa: clean(p.get('mesa')),
      invitados: clean(p.get('invitados'))
    };
  }

  // Lee parámetros de la propia URL (GitHub Pages sí los pasa)
  const data = parseParams(window.location.search);

  // Pinta datos
  document.getElementById('id').textContent = data.id || '—';
  document.getElementById('nombre').textContent = data.nombre || '—';
  document.getElementById('mesa').textContent = data.mesa || '—';
  document.getElementById('invitados').textContent = data.invitados || '—';

  // Construye el link exacto
  const url = window.location.origin + window.location.pathname + window.location.search;
  document.getElementById('link').textContent = url;

  // Validación de obligatorios
  const missing = [];
  if(!data.id) missing.push('id');
  if(!data.nombre) missing.push('nombre');
  if(!data.mesa) missing.push('mesa');
  if(!data.invitados) missing.push('invitados');

  if(missing.length){
    const err = document.getElementById('error');
    err.style.display = 'block';
    err.innerHTML =
      'Faltan parámetros obligatorios: <b>' + missing.join(', ') + '</b>.<br>' +
      'Ejemplo de uso: ?id=1&nombre=MIKE&mesa=10&invitados=10';
    return;
  }

  // Genera QR con la URL completa
  new QRCode(document.getElementById('qrcode'), {
    text: url,
    width: 220,
    height: 220,
    colorDark : "#000000",
    colorLight : "#ffffff",
    correctLevel : QRCode.CorrectLevel.M
  });

  const ok = document.getElementById('status');
  ok.style.display = 'block';
  ok.textContent = 'Invitación generada correctamente.';
})();
</script>
</body>
</html>
